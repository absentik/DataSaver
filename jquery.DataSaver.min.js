/*
 * jQuery DataSaver plugin 0.1.2 
 * https://github.com/absentik/DataSaver
 * 
 * Author: Seleznev Alexander (ABSENT) 
 * Email: absenteg@gmail.com 
 * Website: http://whoisabsent.ru 
 *  
 * Licensed under the MIT license. 
 * http://www.opensource.org/licenses/mit-license.php 
 */

;(function(b,e,g,h){function d(a,c){this.element=a;this._defaults=f;this._name="DataSaver";this.options=b.extend({},f,c);this.action="string"===typeof c?c:"default";this.getkey();this.init()}var f={timeout:0,events:"change",keyUrlAttrs:["host","pathname"],keyExtra:function(){return""}};d.prototype.getkey=function(){var a=this.element.DataSaver_key;if("undefined"===typeof a){var c={};b.each(this.options.keyUrlAttrs,function(a,b){e.location.hasOwnProperty(b)&&(c[b]=e.location[b])});a={tagName:this.element.tagName,
name:this.element.name};b(this.element).is(":input")&&(a.type=this.element.type);b(this.element).is(":radio")||(a.id=this.element.id,a.className=this.element.className);a=["DataSaver",JSON.stringify(c),JSON.stringify(a),this.options.keyExtra()].join(".");this.element.DataSaver_key=a}return a};d.prototype.load=function(){var a=this.getkey(),a=localStorage[a];if(null!=a)switch(this.element.tagName){case "INPUT":switch(b(this.element).attr("type").toUpperCase()){case "CHECKBOX":b(this.element).prop("checked",
"true"===a);break;case "RADIO":b("input[type=radio][name="+this.element.name+"][value="+a+"]").prop("checked",!0);break;default:b(this.element).val(a)}break;case "SELECT":a=a.split(",");b(this.element).val(a);break;case "TEXTAREA":b(this.element).val(a)}return b(this.element).trigger("DataSaver_load")};d.prototype.save=function(){var a=this.getkey(),c;switch(this.element.tagName){case "INPUT":switch(b(this.element).attr("type").toUpperCase()){case "CHECKBOX":c=b(this.element).prop("checked");break;
case "RADIO":c=b(this.element).val();break;default:c=b(this.element).val()}break;case "SELECT":c=b(this.element).val();break;case "TEXTAREA":c=b(this.element).val()}"undefined"!==typeof c&&(localStorage[a]=c);return b(this.element).trigger("DataSaver_save")};d.prototype.remove=function(){var a=this.getkey();localStorage.removeItem(a);return b(this.element).trigger("DataSaver_remove")};d.prototype.start=function(){var a=this;this.stop();this.load();"undefined"!==typeof this.options.events&&0<this.options.events.length&&
(this.options.events=this.options.events.split(",").join(" "),this.element.DataSaver_events=this.options.events,b(this.element).on(this.options.events,function(){a.save()}));"number"===typeof this.options.timeout&&0<this.options.timeout&&(this.element.DataSaver_timeout=setInterval(function(){a.save()},this.options.timeout));return b(this.element).trigger("DataSaver_start")};d.prototype.stop=function(){"undefined"!==typeof this.element.DataSaver_events&&b(g.body).off(this.element.DataSaver_events);
"undefined"!==typeof this.element.DataSaver_timeout&&clearInterval(this.element.DataSaver_timeout);return b(this.element).trigger("DataSaver_stop")};d.prototype.init=function(){switch(this.action){case "load":return this.load();case "save":return this.save();case "remove":return this.remove();case "stop":return this.stop();default:return this.start()}};b.fn.DataSaver=function(a){"localStorage"in e&&null!==e.localStorage||b.error("Your browser doesn't support localStorage.");return this.each(function(){b.data(this,
"plugin_DataSaver",new d(this,a))})}})(jQuery,window,document);
